<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ground Station Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ui-bg': '#B0C4DE',
                        'box-bg': '#D6E4F0',
                        'btn-bg': '#DFE8F0',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 12px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #D6E4F0;
            border-left: 2px solid black;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #94A3B8;
            border: 2px solid black;
            border-radius: 6px;
        }
    </style>
</head>
<body class="bg-ui-bg min-h-screen font-sans p-4 sm:p-6 overflow-hidden flex flex-col">

    <!-- HEADER -->
    <header class="w-full flex flex-wrap justify-between items-start mb-6 gap-4">
        
        <!-- Logo (Top Left) -->
        <div class="flex items-center">
            <div class="w-20 h-20 bg-white rounded-full border-[3px] border-black flex items-center justify-center shadow-lg overflow-hidden z-10">
                <svg viewBox="0 0 24 24" class="w-12 h-12 text-gray-800" fill="currentColor">
                    <path d="M12 2L2 22h20L12 2zm0 4l6 14H6l6-14z"/>
                </svg>
            </div>
        </div>

        <!-- Header Controls -->
        <div class="flex flex-wrap items-start gap-3 mt-2">
            
            <!-- STOP Button -->
            <button onclick="sendStop()" class="w-32 py-2 bg-red-500 border-[3px] border-black rounded-lg text-lg font-bold text-black hover:bg-red-600 transition-colors shadow-md active:translate-y-1">
                STOP
            </button>

            <!-- Update Status Container -->
            <div class="flex flex-col items-center">
                <button onclick="updateStatus()" class="px-4 py-2 bg-btn-bg border-[3px] border-black rounded-lg text-md font-bold leading-tight hover:bg-white transition-colors shadow-md w-48">
                    Update Ground Station Status
                </button>
                <!-- Status Field Underneath -->
                <div id="statusField" class="mt-1 font-black text-lg uppercase tracking-wide text-red-700 bg-white/50 px-2 rounded border border-black/20">
                    Disconnected
                </div>
            </div>

            <!-- Navigation Buttons -->
            <button onclick="window.location.href='/about'" class="w-24 py-2 bg-btn-bg border-[3px] border-black rounded-lg text-lg font-bold hover:bg-white transition-colors shadow-md">
                About
            </button>
            <button onclick="window.location.href='/guest'" class="w-24 py-2 bg-btn-bg border-[3px] border-black rounded-lg text-lg font-bold hover:bg-white transition-colors shadow-md">
                Home
            </button>
        </div>
    </header>

    <!-- MAIN CONTENT (Grid Layout) -->
    <main class="flex-grow w-full grid grid-cols-1 lg:grid-cols-12 gap-6 h-[calc(100vh-160px)]">

        <!-- LEFT COLUMN (Users & Requests) -->
        <div class="lg:col-span-5 flex flex-col gap-6 h-full">
            
            <!-- Users Box -->
            <div class="flex-1 border-[3px] border-black rounded-xl bg-box-bg overflow-hidden shadow-xl flex flex-col min-h-0">
                <div class="bg-gray-200 border-b-[3px] border-black p-2 font-bold text-center uppercase">Active Users</div>
                <div id="usersList" class="overflow-y-auto custom-scroll flex-grow p-2 space-y-2">
                    <!-- Content populated by JS -->
                </div>
            </div>

            <!-- Info Requests Box -->
            <div class="flex-1 border-[3px] border-black rounded-xl bg-box-bg overflow-hidden shadow-xl flex flex-col min-h-0">
                <div class="bg-gray-200 border-b-[3px] border-black p-2 font-bold text-center uppercase">Data Requests</div>
                <div id="requestsList" class="overflow-y-auto custom-scroll flex-grow p-2 space-y-2">
                    <!-- Content populated by JS -->
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN (Logs & Filter) -->
        <div class="lg:col-span-7 flex flex-col h-full relative">
            
            <!-- Logs Box -->
            <div class="flex-grow border-[3px] border-black rounded-xl bg-box-bg overflow-hidden shadow-xl flex flex-col mb-20 lg:mb-0 relative z-10">
                <div class="bg-gray-200 border-b-[3px] border-black p-2 font-bold text-center uppercase">Ground Station Logs</div>
                <div id="logsList" class="overflow-y-auto custom-scroll flex-grow font-mono text-sm p-3 space-y-1">
                    <!-- Content populated by JS -->
                </div>
            </div>

            <!-- Filter Controls (Positioned at bottom-left of the logs area area as per sketch) -->
            <div class="absolute bottom-4 left-[-12rem] lg:left-[-10rem] z-20 flex flex-col gap-2 bg-ui-bg/90 p-2 rounded-lg backdrop-blur-sm">
                 <button onclick="applyFilter()" class="w-32 py-2 bg-btn-bg border-[3px] border-black rounded-lg text-lg font-bold hover:bg-white shadow-lg active:translate-y-1">
                    Apply Filter
                </button>
                <input type="text" id="logFilter" placeholder="Log Type" 
                       class="w-48 p-1 border-[2px] border-gray-500 bg-white/70 text-sm focus:border-black outline-none shadow-sm">
            </div>

        </div>

    </main>

    <script>
        // --- MOCK DATA GENERATORS ---

        const users = [
            { name: "Dr. Aris V.", affiliation: "RMC Space Dept" },
            { name: "Maj. Tom", affiliation: "Ground Control" },
            { name: "Sarah J.", affiliation: "Data Analyst" },
            { name: "Guest_01", affiliation: "External" },
            { name: "Lt. Starbuck", affiliation: "Fleet Ops" }
        ];

        const requests = [
            { user: "Dr. Aris V.", affil: "RMC", set: "Telemetry_Alpha" },
            { user: "Sarah J.", affil: "Analyst", set: "Images_IR_04" },
            { user: "Maj. Tom", affil: "GC", set: "Health_Check_Logs" },
            { user: "Lt. Starbuck", affil: "Fleet", set: "Nav_Vector_Z" }
        ];

        // --- INITIAL RENDER ---

        // Render Users
        const userContainer = document.getElementById('usersList');
        users.forEach(u => {
            userContainer.innerHTML += `
                <div class="flex justify-between items-center p-2 border-b border-black/20">
                    <span class="font-bold">${u.name}</span>
                    <span class="text-sm text-gray-600 italic">${u.affiliation}</span>
                </div>`;
        });

        // Render Requests
        const reqContainer = document.getElementById('requestsList');
        requests.forEach(r => {
            reqContainer.innerHTML += `
                <div class="p-2 border-b border-black/20 text-sm">
                    <div class="flex justify-between font-bold">
                        <span>${r.user}</span>
                        <span class="text-gray-600 text-xs uppercase">${r.affil}</span>
                    </div>
                    <div class="text-blue-800 mt-1">Req: ${r.set}</div>
                </div>`;
        });

        // --- LOGS LOGIC ---
        const logsContainer = document.getElementById('logsList');
        const logTypes = ['INFO', 'WARN', 'ERROR', 'DEBUG', 'CONN'];
        const messages = [
            "Packet received from SAT-1",
            "Handshake attempt 3...",
            "Signal lost momentarily",
            "Buffer flush complete",
            "User login attempt",
            "Telemetry sync started",
            "Antenna azimuth adjusting",
            "Temperature stable at 34C"
        ];

        let allLogs = []; // Store logs to filter later

        function addLog() {
            const type = logTypes[Math.floor(Math.random() * logTypes.length)];
            const msg = messages[Math.floor(Math.random() * messages.length)];
            const time = new Date().toLocaleTimeString();
            
            const logEntry = { time, type, msg, id: Date.now() };
            allLogs.push(logEntry);
            
            // Only render if it matches current filter (simple check)
            const filterTxt = document.getElementById('logFilter').value.toUpperCase();
            if(filterTxt === "" || type.includes(filterTxt)) {
                renderSingleLog(logEntry);
            }

            // Scroll to bottom
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        function renderSingleLog(log) {
            const colorClass = log.type === 'ERROR' ? 'text-red-600 font-bold' : 
                               log.type === 'WARN' ? 'text-orange-600 font-bold' : 'text-black';
            
            const div = document.createElement('div');
            div.className = `border-b border-gray-400 pb-1 ${colorClass}`;
            div.innerHTML = `[${log.time}] <span class="bg-white/50 px-1 rounded text-xs border border-gray-400">${log.type}</span> ${log.msg}`;
            logsContainer.appendChild(div);
        }

        // Auto-upload logs every 2 seconds
        setInterval(addLog, 2000);

        // --- BUTTON FUNCTIONS ---

        function sendStop() {
            // Simulate STOP Request
            alert("CRITICAL: STOP REQUEST SENT TO SERVER.");
            logsContainer.innerHTML += `<div class="bg-red-500 text-white font-bold p-1 text-center">!!! STOP SIGNAL SENT !!!</div>`;
        }

        let isConnected = false;
        function updateStatus() {
            // Simulate server request
            const statusField = document.getElementById('statusField');
            const btn = document.querySelector('button[onclick="updateStatus()"]');
            
            btn.innerText = "Checking...";
            
            setTimeout(() => {
                btn.innerText = "Update Ground Station Status";
                isConnected = !isConnected; // Toggle for demo
                
                if(isConnected) {
                    statusField.innerText = "Connected";
                    statusField.className = "mt-1 font-black text-lg uppercase tracking-wide text-green-700 bg-white/80 px-2 rounded border border-green-600 shadow-[0_0_10px_rgba(0,255,0,0.5)]";
                } else {
                    statusField.innerText = "Disconnected";
                    statusField.className = "mt-1 font-black text-lg uppercase tracking-wide text-red-700 bg-white/50 px-2 rounded border border-black/20";
                }
            }, 800);
        }

        function applyFilter() {
            const filterText = document.getElementById('logFilter').value.toUpperCase();
            
            // Clear current view
            logsContainer.innerHTML = "";
            
            // Re-render matching logs
            allLogs.forEach(log => {
                if(filterText === "" || log.type.includes(filterText)) {
                    renderSingleLog(log);
                }
            });
            
            if(filterText) {
                logsContainer.innerHTML += `<div class="text-center text-gray-500 italic text-xs py-2">-- Filter Applied: ${filterText} --</div>`;
            }
        }
    </script>
</body>
</html>